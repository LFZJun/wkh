{"version":3,"sources":["webpack:///webpack/bootstrap 97861f378610e944d0e0","webpack:///./src/consts.ts","webpack:///./src/router.ts","webpack:///./src/inject.js"],"names":[],"mappings":"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","file":"inject.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 97861f378610e944d0e0","export const QUICK = \"quick\";\nexport const SLOW = \"slow\";\nexport const VALUE = \"value\";\nexport const HOME = \"/inject/home\";\nexport const MONKEY = \"/inject/monkey\";\nexport const TRANSACTION = \"/background/transaction\";\n\n\n// WEBPACK FOOTER //\n// ./src/consts.ts","export type Handler = ((ctx: Context) => Promise<any>)\n\nasync function Next(ctx: Context) {\n    let handlers = ctx.handlers;\n    let n = ctx.handlerIndex(-1) + 1;\n    if (n < handlers.length) {\n        ctx.handlerIndex(n);\n        await handlers[n](ctx);\n    }\n}\n\nexport class Context {\n    request: { path: string, [key: string]: any };\n    sender: any;\n    response: any;\n\n    handlers: Handler[];\n    values: { [key: string]: any };\n    currentHandlerIndex: number;\n\n\n    constructor(handlers: Handler[] = [], values: { [p: string]: any } = {}, currentHandlerIndex: number = 0) {\n        this.handlers = handlers;\n        this.values = values;\n        this.currentHandlerIndex = currentHandlerIndex;\n    }\n\n    async next() {\n        await Next(this);\n    }\n\n    handlerIndex(n: number): number {\n        if (n < 0 || n > this.handlers.length - 1) {\n            return this.currentHandlerIndex\n        }\n\n        return this.currentHandlerIndex = n;\n    }\n}\n\nexport class Route {\n    handlers: Handler[];\n\n    constructor(handlers: Handler[] = []) {\n        this.handlers = handlers;\n    }\n\n    join(...handlers: Handler[]) {\n        this.handlers.push(...handlers);\n    }\n}\n\nexport class Router {\n    middleware: Handler[];\n    routes: { [key: string]: Route };\n\n    constructor(middleware: Handler[] = [], routes: { [p: string]: Route } = {}) {\n        this.middleware = middleware;\n        this.routes = routes;\n    }\n\n    use(...handlers: Handler[]) {\n        this.middleware.push(...handlers);\n    }\n\n    handle(key: string, ...handlers: Handler[]) {\n        if (this.routes[key] == null) {\n            this.routes[key] = new Route([...handlers]);\n        }\n        this.routes[key].join(...handlers);\n    }\n\n    async serve(key: string, ctx: Context) {\n        let route = this.routes[key];\n        if (route == null) {\n            return\n        }\n        ctx.handlers = [...this.middleware, ...route.handlers];\n        await Next(ctx)\n    }\n\n    run() {\n        chrome.runtime.onMessage.addListener(\n            (request: any, sender: any, sendResponse: (response: any) => void) => {\n                let context = new Context();\n                context.request = request;\n                context.sender = sender;\n                context.response = {};\n                this.serve(request.path, context).\n                catch(function (err) {\n                    console.log(err);\n                    sendResponse(context.response);\n                }).then(function () {\n                    sendResponse(context.response)\n                });\n            }\n        );\n    }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/router.ts","import { Router } from './router.ts';\nimport { HOME, MONKEY, SLOW, QUICK, TRANSACTION, VALUE } from './consts.ts';\n\n\nconst MONKEYS = \"monkeys\";\nconst ITEM = \"item\";\n\nconsole.log(\"注入页面\");\nlet confirmed = false;\n\nconst router = new Router();\nrouter.use(ctx => {\n    console.log(\"页面发生变化\");\n    ctx.next();\n});\n\n// monkeys\nrouter.handle(HOME, ctx => {\n    return new Promise((resolve, reject) => {\n        $(\"div\").forEach(element => {\n            let element$ = $(element);\n\n            if (element$.hasClass(MONKEYS)) {\n                element$.find(\".panel\").forEach(monkey => {\n                    let btns = [];\n\n                    btns.push({\n                        button: $('<button style=\"margin:1px;border-color:red;\">最大次数喂养</button>'),\n                        mode: SLOW\n                    });\n                    btns.push({\n                        button: $('<button style=\"margin:1px;border-color:red;\">最少次数喂养</button>'),\n                        mode: QUICK\n                    });\n                    console.log(monkey);\n                    let elementMonkey = $(monkey);\n                    let percent = elementMonkey.find(\".percent\").first().text();\n                    let doFeed = function (self, mode) {\n                        GetWhiteList().then(whitelist => {\n                            let prompt = \"喂养一只猴子需要向作者转账0.5WKC请确认\";\n                            let reward = true;\n                            let {address} = JSON.parse(ctx.request.wallet);\n                            if (whitelist.indexOf(`0x${address}`) !== -1) {\n                                prompt = \"请确定喂养\";\n                                reward = false;\n                            }\n                            if (!confirmed) {\n                                if (!confirm(prompt)) {\n                                    return\n                                }\n                                confirmed = true\n                            }\n                            btns.forEach(btn => {\n                                btn.button.hide()\n                            });\n                            chrome.runtime.sendMessage({\n                                path: TRANSACTION,\n                                id: elementMonkey.find(\".id\").first().text().split(' ')[1],\n                                limit: Number((percent.split('/')[1] - percent.split('/')[0]).toFixed(2)),\n                                mode: mode,\n                                reward: reward,\n                            }, function (response) {\n                                console.log(response);\n                            });\n                        });\n                    };\n                    btns.forEach(btn => {\n                        btn.button.click(function () {\n                            doFeed($(this), btn.mode);\n                        });\n                    });\n                    console.log(\"has button\", elementMonkey.has(\"button\").length);\n                    if (elementMonkey.find(\"button\").length === 0) {\n                        btns.forEach(btn => {\n                            elementMonkey.append(btn.button);\n                        });\n                    }\n                })\n            }\n        });\n        resolve();\n    });\n});\n//items\nrouter.handle(MONKEY, ctx => {\n    return new Promise((resolve, reject) => {\n        $(\"div\").forEach(element => {\n            let element$ = $(element);\n\n            if (element$.hasClass(ITEM)) {\n                let info = $(element$.find(\".info p\").get(1)).text();\n                let priceDiv = element$.find(\".price span\").first();\n                let price = $(element$.find(\".price span\").get(0)).text();\n                if (!info || !priceDiv || !price) {\n                    return\n                }\n                let kg = info.split('·')[1].split(' ')[0];\n                let arg1 = info.split('·')[0].split('/')[0];\n                let arg2 = info.split('·')[0].split('/')[1];\n                let arg3 = info.split('·')[0].split('/')[2];\n                let wkc = price.split(' ')[0];\n                let span = $(element$.find(\".price\").find(\".price span\").get(0));\n                if (span.text().indexOf(\";\") !== -1) {\n                    wkc = span.text().split(';')[0]\n                }\n                let request = ctx.request;\n                console.log(request.mode, request.min);\n                let mark = arg1 * arg3 * (request.kg === \"true\" ? kg : 1);\n                let showMark = request.mode === VALUE ? mark : mark / wkc;\n                span.text(wkc + \";\" + (showMark).toFixed(5));\n                if (showMark >= request.min) {\n                    element$.prop(\"style\", \"background:#F00;\")\n                }\n            }\n        });\n        resolve();\n    });\n});\n\nrouter.run();\n\nconst GetWhiteList = function () {\n    return new Promise((rs, rj) => {\n        $.getJSON(\"http://mxz-upload-public.oss-cn-hangzhou.aliyuncs.com/wkh/whitelist.json\", function (resp) {\n            rs(resp)\n        })\n    })\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/inject.js\n// module id = 3\n// module chunks = 0"],"sourceRoot":""}